<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrintFlow Pro</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body class="bg-gray-50 font-sans">

<div id="root"></div>

<script type="text/babel">

// ===== Constants =====
const JobStage = {
  COUNTER: 'COUNTER',
  DESIGN: 'DESIGN',
  PRODUCTION: 'PRODUCTION',
  FINISHING: 'FINISHING',
  CASHIER: 'CASHIER',
  COMPLETED: 'COMPLETED'
};

const STAGE_COLORS = {
  [JobStage.COUNTER]: 'bg-slate-100 text-slate-700 border-slate-300',
  [JobStage.DESIGN]: 'bg-blue-100 text-blue-700 border-blue-300',
  [JobStage.PRODUCTION]: 'bg-purple-100 text-purple-700 border-purple-300',
  [JobStage.FINISHING]: 'bg-orange-100 text-orange-700 border-orange-300',
  [JobStage.CASHIER]: 'bg-emerald-100 text-emerald-700 border-emerald-300',
  [JobStage.COMPLETED]: 'bg-gray-200 text-gray-500 border-gray-300'
};

const STAGE_ORDER = [
  JobStage.COUNTER,
  JobStage.DESIGN,
  JobStage.PRODUCTION,
  JobStage.FINISHING,
  JobStage.CASHIER,
  JobStage.COMPLETED
];

const STAGE_DEFAULT_ASSIGNEE = {
  [JobStage.COUNTER]: 'Alice (Counter)',
  [JobStage.DESIGN]: 'Bob (Designer)',
  [JobStage.PRODUCTION]: 'Charlie (Production)',
  [JobStage.FINISHING]: 'David (Finisher)',
  [JobStage.CASHIER]: 'Eva (Cashier)',
  [JobStage.COMPLETED]: 'Eva (Cashier)'
};

function getNextStage(currentStage, jobType) {
  const index = STAGE_ORDER.indexOf(currentStage);
  if(index >= STAGE_ORDER.length - 1) return null;
  let next = STAGE_ORDER[index + 1];
  if(jobType==='Xerox' && next===JobStage.DESIGN) {
    next = JobStage.PRODUCTION;
  }
  return next;
}

// ===== LocalStorage Services =====
function getJobs(){ return JSON.parse(localStorage.getItem('jobs')||'[]'); }
function saveJobs(jobs){ localStorage.setItem('jobs', JSON.stringify(jobs)); }
function seedData(){
  const now = Date.now();
  const jobs = [{id:'JOB-1001', customerName:'John Doe', type:'Print', priority:'Normal', currentStage:JobStage.COUNTER, assignedTo:'Alice (Counter)', description:'Business cards', createdAt:now, updatedAt:now, history:[{stage:JobStage.COUNTER,timestamp:now}]}];
  saveJobs(jobs);
  return jobs;
}
function getCurrentUser(){ return JSON.parse(localStorage.getItem('currentUser')||'null'); }
function loginUser(u){ localStorage.setItem('currentUser',JSON.stringify(u)); }
function logoutUser(){ localStorage.removeItem('currentUser'); }

// ===== Components =====
function Layout({children, activeTab, onTabChange, user, onLogout}) {
  return (
    <div className="p-4">
      <div className="flex justify-between items-center mb-4">
        <h1 className="text-2xl font-bold">PrintFlow Pro</h1>
        <div>
          <span className="mr-4">{user.name} ({user.role})</span>
          <button className="bg-red-500 text-white px-2 py-1 rounded" onClick={onLogout}>Logout</button>
        </div>
      </div>
      <div className="flex space-x-2 mb-4">
        <button onClick={()=>onTabChange('dashboard')} className={`px-2 py-1 rounded ${activeTab==='dashboard'?'bg-blue-500 text-white':'bg-gray-200'}`}>Dashboard</button>
        <button onClick={()=>onTabChange('jobs')} className={`px-2 py-1 rounded ${activeTab==='jobs'?'bg-blue-500 text-white':'bg-gray-200'}`}>Jobs</button>
        <button onClick={()=>onTabChange('new')} className={`px-2 py-1 rounded ${activeTab==='new'?'bg-blue-500 text-white':'bg-gray-200'}`}>New Job</button>
        {user.role==='Admin' && <button onClick={()=>onTabChange('admin')} className={`px-2 py-1 rounded ${activeTab==='admin'?'bg-blue-500 text-white':'bg-gray-200'}`}>Admin</button>}
      </div>
      {children}
    </div>
  );
}

function JobCard({job, onAdvance, onDelete}) {
  const nextStage = getNextStage(job.currentStage, job.type);
  const isCompleted = job.currentStage===JobStage.COMPLETED;
  return (
    <div className={`bg-white rounded-xl shadow-sm border p-5 mb-3 flex flex-col border-l-6 ${job.priority==='Urgent'?'border-l-red-500':'border-l-indigo-500'}`}>
      <div className="flex justify-between mb-2">
        <span className="text-xs font-mono font-bold text-slate-400">#{job.id}</span>
        <span className="text-xs uppercase px-2 py-1 rounded-full border">{job.priority}</span>
      </div>
      <h3 className="font-bold text-slate-800">{job.customerName}</h3>
      <p className="text-sm text-slate-600 flex-grow">{job.description}</p>
      <div className="flex justify-between mt-2">
        <span className="text-xs text-slate-500">{job.type}</span>
        <span className="text-xs text-slate-800">â‚¹{job.price}</span>
      </div>
      <div className="flex justify-between mt-2 items-center">
        {!isCompleted && nextStage && <button className="bg-indigo-600 text-white px-2 py-1 rounded" onClick={()=>onAdvance(job.id)}>Move to {nextStage}</button>}
        {isCompleted && <span className="bg-green-100 text-green-600 px-2 py-1 rounded">Completed</span>}
        <button className="text-red-500 px-2 py-1 rounded" onClick={()=>onDelete(job.id)}>Delete</button>
      </div>
    </div>
  );
}

function Dashboard({jobs}) {
  return <div><h2 className="text-xl font-bold mb-2">Dashboard</h2><p>Total Jobs: {jobs.length}</p></div>;
}

function JobBoard({jobs, onAdvance, onDelete}) {
  return <div><h2 className="text-xl font-bold mb-2">Job Board</h2>{jobs.map(j=><JobCard key={j.id} job={j} onAdvance={onAdvance} onDelete={onDelete} />)}</div>;
}

function NewJob({onSubmit, onCancel}) {
  const [customerName,setCustomerName]=React.useState('');
  const [type,setType]=React.useState('Print');
  const [description,setDescription]=React.useState('');
  return (
    <div>
      <h2 className="text-xl font-bold mb-2">New Job</h2>
      <input placeholder="Customer Name" value={customerName} onChange={e=>setCustomerName(e.target.value)} className="border p-1 rounded w-full mb-2"/>
      <select value={type} onChange={e=>setType(e.target.value)} className="border p-1 rounded w-full mb-2"><option>Print</option><option>Xerox</option></select>
      <textarea placeholder="Description" value={description} onChange={e=>setDescription(e.target.value)} className="border p-1 rounded w-full mb-2"></textarea>
      <div className="flex space-x-2">
        <button className="bg-blue-500 text-white px-2 py-1 rounded" onClick={()=>{if(!customerName){alert('Name required');return;} onSubmit({customerName,type,description,priority:'Normal',currentStage:JobStage.COUNTER,assignedTo:STAGE_DEFAULT_ASSIGNEE[JobStage.COUNTER]})}}>Create</button>
        <button className="bg-gray-300 px-2 py-1 rounded" onClick={onCancel}>Cancel</button>
      </div>
    </div>
  );
}

function Login({onLogin}) {
  const [name,setName]=React.useState('');
  const [role,setRole]=React.useState('User');
  return (
    <div className="p-4 max-w-md mx-auto mt-20 border rounded space-y-2 bg-white">
      <h2 className="text-xl font-bold mb-2">Login</h2>
      <input placeholder="Name" value={name} onChange={e=>setName(e.target.value)} className="border p-1 rounded w-full"/>
      <select value={role} onChange={e=>setRole(e.target.value)} className="border p-1 rounded w-full">
        <option>User</option><option>Admin</option>
      </select>
      <button className="bg-blue-500 text-white px-2 py-1 rounded w-full mt-2" onClick={()=>{if(!name){alert('Enter name');return;} onLogin({name,role})}}>Login</button>
    </div>
  );
}

function AdminPanel({jobs}) {
  return <div><h2 className="text-xl font-bold mb-2">Admin Panel</h2><p>Manage {jobs.length} jobs</p></div>;
}

// ===== App =====
function App() {
  const [user,setUser]=React.useState(getCurrentUser());
  const [activeTab,setActiveTab]=React.useState('dashboard');
  const [jobs,setJobs]=React.useState(getJobs().length===0?seedData():getJobs());

  const handleLogin = (u)=>{ setUser(u); loginUser(u); setActiveTab('dashboard'); };
  const handleLogout = ()=>{ setUser(null); logoutUser(); };
  const handleCreateJob = (job)=>{ const now=Date.now(); const newJob={...job,id:`JOB-${Math.floor(1000+Math.random()*9000)}`,createdAt:now,updatedAt:now,history:[{stage:JobStage.COUNTER,timestamp:now}]}; const updated=[...jobs,newJob]; setJobs(updated); saveJobs(updated); setActiveTab('jobs');};
  const handleAdvanceJob = (id)=>{ const updated=jobs.map(j=>{ if(j.id===id){ const next=getNextStage(j.currentStage,j.type); if(next){ const now=Date.now(); return {...j,currentStage:next,assignedTo:STAGE_DEFAULT_ASSIGNEE[next]||j.assignedTo,updatedAt:now,history:[...j.history,{stage:next,timestamp:now}]};} } return j;}); setJobs(updated); saveJobs(updated); };
  const handleDeleteJob = (id)=>{ if(window.confirm('Are you sure?')){ const updated=jobs.filter(j=>j.id!==id); setJobs(updated); saveJobs(updated); }};

  if(!user) return <Login onLogin={handleLogin} />;

  return (
    <Layout activeTab={activeTab} onTabChange={setActiveTab} user={user} onLogout={handleLogout}>
      {activeTab==='dashboard'&&<Dashboard jobs={jobs}/>}
      {activeTab==='jobs'&&<JobBoard jobs={jobs} onAdvance={handleAdvanceJob} onDelete={handleDeleteJob}/>}
      {activeTab==='new'&&<NewJob onSubmit={handleCreateJob} onCancel={()=>setActiveTab('jobs')}/>}
      {activeTab==='admin'&&user.role==='Admin'&&<AdminPanel jobs={jobs}/>}
    </Layout>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);

</script>
</body>
</html>
