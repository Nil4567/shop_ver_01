<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PrintFlow Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
</head>
<body>
<div id="root"></div>

<!-- React and ReactDOM from CDN -->
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<script type="text/babel">

/* ====== Constants and JobStage ====== */
const JobStage = {
  COUNTER: 'COUNTER',
  DESIGN: 'DESIGN',
  PRODUCTION: 'PRODUCTION',
  FINISHING: 'FINISHING',
  CASHIER: 'CASHIER',
  COMPLETED: 'COMPLETED'
};

const APP_VERSION = '1.1.0';

const STAGE_COLORS = {
  [JobStage.COUNTER]: 'bg-slate-100 text-slate-700 border-slate-300',
  [JobStage.DESIGN]: 'bg-blue-100 text-blue-700 border-blue-300',
  [JobStage.PRODUCTION]: 'bg-purple-100 text-purple-700 border-purple-300',
  [JobStage.FINISHING]: 'bg-orange-100 text-orange-700 border-orange-300',
  [JobStage.CASHIER]: 'bg-emerald-100 text-emerald-700 border-emerald-300',
  [JobStage.COMPLETED]: 'bg-gray-200 text-gray-500 border-gray-300'
};

const STAGE_ORDER = [
  JobStage.COUNTER,
  JobStage.DESIGN,
  JobStage.PRODUCTION,
  JobStage.FINISHING,
  JobStage.CASHIER,
  JobStage.COMPLETED
];

const EMPLOYEES = [
  'Alice (Counter)',
  'Bob (Designer)',
  'Charlie (Production)',
  'David (Finisher)',
  'Eva (Cashier)'
];

const STAGE_DEFAULT_ASSIGNEE = {
  [JobStage.COUNTER]: 'Alice (Counter)',
  [JobStage.DESIGN]: 'Bob (Designer)',
  [JobStage.PRODUCTION]: 'Charlie (Production)',
  [JobStage.FINISHING]: 'David (Finisher)',
  [JobStage.CASHIER]: 'Eva (Cashier)',
  [JobStage.COMPLETED]: 'Eva (Cashier)'
};

const JOB_DEFAULTS = {
  customerName: 'Unknown Customer',
  type: 'Print',
  priority: 'Normal',
  currentStage: JobStage.COUNTER,
  price: 0,
  assignedTo: 'Unassigned',
  description: 'No description provided'
};

function getNextStage(currentStage, jobType) {
  const currentIndex = STAGE_ORDER.indexOf(currentStage);
  if (currentIndex >= STAGE_ORDER.length - 1) return null;
  let nextStage = STAGE_ORDER[currentIndex + 1];
  if (jobType === 'Xerox' && nextStage === JobStage.DESIGN) {
    const designIndex = STAGE_ORDER.indexOf(JobStage.DESIGN);
    nextStage = STAGE_ORDER[designIndex + 1];
  }
  return nextStage;
}

/* ====== LocalStorage Services ====== */
function getJobs() {
  const data = localStorage.getItem('jobs');
  return data ? JSON.parse(data) : [];
}

function saveJobs(jobs) {
  localStorage.setItem('jobs', JSON.stringify(jobs));
}

function seedData() {
  const now = Date.now();
  const jobs = [
    {id:'JOB-1001', customerName:'John Doe', type:'Print', priority:'Normal', currentStage:JobStage.COUNTER, assignedTo:'Alice (Counter)', description:'Business cards', createdAt:now, updatedAt:now, history:[{stage:JobStage.COUNTER, timestamp:now}]}
  ];
  saveJobs(jobs);
  return jobs;
}

function getCurrentUser() {
  const user = localStorage.getItem('currentUser');
  return user ? JSON.parse(user) : null;
}

function loginUser(user) {
  localStorage.setItem('currentUser', JSON.stringify(user));
}

function logoutUser() {
  localStorage.removeItem('currentUser');
}

/* ====== Components ====== */

function Layout({children, activeTab, onTabChange, user, onLogout}) {
  return (
    <div className="p-4">
      <div className="flex justify-between items-center mb-4">
        <h1 className="text-2xl font-bold">PrintFlow Pro</h1>
        <div>
          <span className="mr-4">{user.name} ({user.role})</span>
          <button className="bg-red-500 text-white px-2 py-1 rounded" onClick={onLogout}>Logout</button>
        </div>
      </div>
      <div className="flex space-x-2 mb-4">
        <button onClick={()=>onTabChange('dashboard')} className={`px-2 py-1 rounded ${activeTab==='dashboard'?'bg-blue-500 text-white':'bg-gray-200'}`}>Dashboard</button>
        <button onClick={()=>onTabChange('jobs')} className={`px-2 py-1 rounded ${activeTab==='jobs'?'bg-blue-500 text-white':'bg-gray-200'}`}>Jobs</button>
        <button onClick={()=>onTabChange('new')} className={`px-2 py-1 rounded ${activeTab==='new'?'bg-blue-500 text-white':'bg-gray-200'}`}>New Job</button>
        {user.role==='Admin' && <button onClick={()=>onTabChange('admin')} className={`px-2 py-1 rounded ${activeTab==='admin'?'bg-blue-500 text-white':'bg-gray-200'}`}>Admin</button>}
      </div>
      <div>{children}</div>
    </div>
  );
}

function Dashboard({jobs}) {
  return (
    <div>
      <h2 className="text-xl font-bold mb-2">Dashboard</h2>
      <p>Total Jobs: {jobs.length}</p>
    </div>
  );
}

function JobBoard({jobs, onAdvance, onDelete}) {
  return (
    <div>
      <h2 className="text-xl font-bold mb-2">Job Board</h2>
      <div className="space-y-2">
        {jobs.map(job=>(
          <div key={job.id} className={`p-2 border rounded ${STAGE_COLORS[job.currentStage]}`}>
            <div className="flex justify-between items-center">
              <div>
                <strong>{job.customerName}</strong> - {job.type} - {job.assignedTo}
              </div>
              <div className="space-x-1">
                {job.currentStage!==JobStage.COMPLETED && <button className="bg-green-500 text-white px-1 rounded" onClick={()=>onAdvance(job.id)}>Next Stage</button>}
                <button className="bg-red-500 text-white px-1 rounded" onClick={()=>onDelete(job.id)}>Delete</button>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

function NewJob({onSubmit, onCancel}) {
  const [customerName,setCustomerName] = React.useState('');
  const [type,setType] = React.useState('Print');
  const [description,setDescription] = React.useState('');
  const handleSubmit = ()=> {
    if(customerName===''){alert('Customer Name required');return;}
    onSubmit({customerName,type,description,priority:'Normal',currentStage:JobStage.COUNTER,assignedTo:STAGE_DEFAULT_ASSIGNEE[JobStage.COUNTER]});
  };
  return (
    <div className="space-y-2">
      <h2 className="text-xl font-bold mb-2">New Job</h2>
      <input type="text" placeholder="Customer Name" className="border p-1 rounded w-full" value={customerName} onChange={e=>setCustomerName(e.target.value)} />
      <select className="border p-1 rounded w-full" value={type} onChange={e=>setType(e.target.value)}>
        <option value="Print">Print</option>
        <option value="Xerox">Xerox</option>
      </select>
      <textarea className="border p-1 rounded w-full" placeholder="Description" value={description} onChange={e=>setDescription(e.target.value)}></textarea>
      <div className="space-x-2">
        <button className="bg-blue-500 text-white px-2 py-1 rounded" onClick={handleSubmit}>Create Job</button>
        <button className="bg-gray-300 px-2 py-1 rounded" onClick={onCancel}>Cancel</button>
      </div>
    </div>
  );
}

function Login({onLogin}) {
  const [name,setName] = React.useState('');
  const [role,setRole] = React.useState('User');
  const handleLogin = ()=>{
    if(name===''){alert('Enter name');return;}
    onLogin({name,role});
  };
  return (
    <div className="p-4 max-w-md mx-auto mt-20 border rounded space-y-2 bg-white">
      <h2 className="text-xl font-bold mb-2">Login</h2>
      <input type="text" placeholder="Name" className="border p-1 rounded w-full" value={name} onChange={e=>setName(e.target.value)} />
      <select className="border p-1 rounded w-full" value={role} onChange={e=>setRole(e.target.value)}>
        <option value="User">User</option>
        <option value="Admin">Admin</option>
      </select>
      <button className="bg-blue-500 text-white px-2 py-1 rounded w-full" onClick={handleLogin}>Login</button>
    </div>
  );
}

function AdminPanel({jobs}) {
  return (
    <div>
      <h2 className="text-xl font-bold mb-2">Admin Panel</h2>
      <p>Manage {jobs.length} jobs here.</p>
    </div>
  );
}

/* ====== Main App Component ====== */
function App() {
  const [user,setUser] = React.useState(getCurrentUser());
  const [activeTab,setActiveTab] = React.useState('dashboard');
  const [jobs,setJobs] = React.useState(getJobs().length===0 ? seedData() : getJobs());

  const handleLoginUser = (u)=>{
    setUser(u); loginUser(u); setActiveTab('dashboard');
  };
  const handleLogoutUser = ()=>{
    setUser(null); logoutUser();
  };
  const handleCreateJob = (newJobData)=>{
    const now = Date.now();
    const newJob = {...newJobData, id:`JOB-${Math.floor(1000+Math.random()*9000)}`, createdAt:now, updatedAt:now, history:[{stage:JobStage.COUNTER, timestamp:now}]};
    const updatedJobs = [...jobs,newJob];
    setJobs(updatedJobs); saveJobs(updatedJobs); setActiveTab('jobs');
  };
  const handleAdvanceJob = (id)=>{
    const updatedJobs = jobs.map(job=>{
      if(job.id===id){
        const nextStage = getNextStage(job.currentStage, job.type);
        if(nextStage){
          const now = Date.now();
          const historyEntry = {stage:nextStage, timestamp:now};
          const nextAssignee = STAGE_DEFAULT_ASSIGNEE[nextStage] || job.assignedTo;
          return {...job, currentStage:nextStage, assignedTo:nextAssignee, updatedAt:now, completedAt: nextStage===JobStage.COMPLETED ? now : undefined, history:[...job.history, historyEntry]};
        }
      }
      return job;
    });
    setJobs(updatedJobs); saveJobs(updatedJobs);
  };
  const handleDeleteJob = (id)=>{
    if(window.confirm('Are you sure you want to delete this job?')){
      const updatedJobs = jobs.filter(j=>j.id!==id);
      setJobs(updatedJobs); saveJobs(updatedJobs);
    }
  };

  if(!user) return <Login onLogin={handleLoginUser} />;

  return (
    <Layout activeTab={activeTab} onTabChange={setActiveTab} user={user} onLogout={handleLogoutUser}>
      {activeTab==='dashboard' && <Dashboard jobs={jobs} />}
      {activeTab==='jobs' && <JobBoard jobs={jobs} onAdvance={handleAdvanceJob} onDelete={handleDeleteJob} />}
      {activeTab==='new' && <NewJob onSubmit={handleCreateJob} onCancel={()=>setActiveTab('jobs')} />}
      {activeTab==='admin' && user.role==='Admin' && <AdminPanel jobs={jobs} />}
    </Layout>
  );
}

/* ====== Render App ====== */
ReactDOM.createRoot(document.getElementById('root')).render(<App />);

</script>
</body>
</html>
