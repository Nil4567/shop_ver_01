<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PrintFlow Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">

// ----------- Constants & Storage ----------
const JobStage = {
  COUNTER: 'Counter',
  PROCESSING: 'Processing',
  COMPLETED: 'Completed'
};

const STAGE_DEFAULT_ASSIGNEE = {
  Counter: 'User A',
  Processing: 'User B',
  Completed: 'User C'
};

function getJobs() {
  return JSON.parse(localStorage.getItem('jobs') || '[]');
}
function saveJobs(jobs) {
  localStorage.setItem('jobs', JSON.stringify(jobs));
}
function getCurrentUser() {
  return JSON.parse(localStorage.getItem('currentUser') || 'null');
}
function loginUser(user) {
  localStorage.setItem('currentUser', JSON.stringify(user));
}
function logoutUser() {
  localStorage.removeItem('currentUser');
}
function seedData() {
  const jobs = [
    { id: 'JOB-1001', title: 'Business Card', type: 'Print', currentStage: JobStage.COUNTER, assignedTo: 'User A', history: [], createdAt: Date.now(), updatedAt: Date.now() }
  ];
  saveJobs(jobs);
  return jobs;
}
function getNextStage(currentStage) {
  if(currentStage === JobStage.COUNTER) return JobStage.PROCESSING;
  if(currentStage === JobStage.PROCESSING) return JobStage.COMPLETED;
  return null;
}

// ----------- Components ----------
function Layout({ activeTab, onTabChange, user, onLogout, children }) {
  return (
    <div>
      <nav className="bg-blue-600 text-white p-4 flex justify-between">
        <div className="flex space-x-4">
          <button onClick={() => onTabChange('dashboard')} className="hover:underline">Dashboard</button>
          <button onClick={() => onTabChange('jobs')} className="hover:underline">Jobs</button>
          <button onClick={() => onTabChange('new')} className="hover:underline">New Job</button>
          {user.role === 'Admin' && <button onClick={() => onTabChange('admin')} className="hover:underline">Admin</button>}
        </div>
        <div>
          <span className="mr-4">{user.name}</span>
          <button onClick={onLogout} className="bg-red-500 px-2 py-1 rounded hover:bg-red-600">Logout</button>
        </div>
      </nav>
      <main className="p-6">{children}</main>
    </div>
  );
}

function Login({ onLogin }) {
  const [name, setName] = React.useState('');
  const [role, setRole] = React.useState('User');

  return (
    <div className="max-w-md mx-auto mt-20 bg-white p-6 rounded shadow">
      <h1 className="text-2xl font-bold mb-4 text-center">Login</h1>
      <input className="w-full p-2 border mb-2 rounded" placeholder="Name" value={name} onChange={e => setName(e.target.value)} />
      <select className="w-full p-2 border mb-4 rounded" value={role} onChange={e => setRole(e.target.value)}>
        <option>User</option>
        <option>Admin</option>
      </select>
      <button className="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700" onClick={() => onLogin({name, role})}>Login</button>
    </div>
  );
}

function Dashboard({ jobs }) {
  return (
    <div>
      <h2 className="text-xl font-bold mb-4">Dashboard</h2>
      <p>Total Jobs: {jobs.length}</p>
    </div>
  );
}

function JobBoard({ jobs, onAdvance, onDelete }) {
  return (
    <div>
      <h2 className="text-xl font-bold mb-4">Jobs</h2>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {jobs.map(job => (
          <div key={job.id} className="p-4 bg-white rounded shadow">
            <h3 className="font-semibold">{job.title}</h3>
            <p>Stage: {job.currentStage}</p>
            <p>Assigned To: {job.assignedTo}</p>
            <div className="mt-2 space-x-2">
              {job.currentStage !== JobStage.COMPLETED && <button onClick={() => onAdvance(job.id)} className="bg-green-500 px-2 py-1 rounded text-white hover:bg-green-600">Advance</button>}
              <button onClick={() => onDelete(job.id)} className="bg-red-500 px-2 py-1 rounded text-white hover:bg-red-600">Delete</button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

function NewJob({ onSubmit, onCancel }) {
  const [title, setTitle] = React.useState('');
  const [type, setType] = React.useState('Print');

  return (
    <div className="max-w-md mx-auto bg-white p-6 rounded shadow">
      <h2 className="text-xl font-bold mb-4">New Job</h2>
      <input className="w-full p-2 border mb-2 rounded" placeholder="Job Title" value={title} onChange={e => setTitle(e.target.value)} />
      <input className="w-full p-2 border mb-2 rounded" placeholder="Job Type" value={type} onChange={e => setType(e.target.value)} />
      <div className="flex space-x-2 mt-2">
        <button className="bg-blue-600 px-4 py-2 text-white rounded hover:bg-blue-700" onClick={() => { onSubmit({title,type,currentStage:JobStage.COUNTER,assignedTo:STAGE_DEFAULT_ASSIGNEE[JobStage.COUNTER]}); setTitle(''); setType('Print'); }}>Submit</button>
        <button className="bg-gray-400 px-4 py-2 text-white rounded hover:bg-gray-500" onClick={onCancel}>Cancel</button>
      </div>
    </div>
  );
}

function AdminPanel({ jobs }) {
  return (
    <div>
      <h2 className="text-xl font-bold mb-4">Admin Panel</h2>
      <p>Jobs Overview:</p>
      <ul className="list-disc pl-6">
        {jobs.map(job => <li key={job.id}>{job.title} - {job.currentStage}</li>)}
      </ul>
    </div>
  );
}

// ----------- Main App ----------
function App() {
  const [user, setUser] = React.useState(getCurrentUser());
  const [activeTab, setActiveTab] = React.useState('dashboard');
  const [jobs, setJobsState] = React.useState(getJobs().length ? getJobs() : seedData());

  const handleLogin = (u) => { setUser(u); loginUser(u); setActiveTab('dashboard'); };
  const handleLogout = () => { setUser(null); logoutUser(); };

  const handleCreateJob = (newJobData) => {
    const now = Date.now();
    const newJob = { ...newJobData, id:'JOB-'+Math.floor(1000+Math.random()*9000), createdAt:now, updatedAt:now, history:[{stage:JobStage.COUNTER,timestamp:now}]};
    const updatedJobs = [...jobs, newJob];
    setJobsState(updatedJobs);
    saveJobs(updatedJobs);
    setActiveTab('jobs');
  };

  const handleAdvanceJob = (id) => {
    const updatedJobs = jobs.map(job => {
      if(job.id===id){
        const nextStage = getNextStage(job.currentStage);
        if(nextStage){
          const now = Date.now();
          const nextAssignee = STAGE_DEFAULT_ASSIGNEE[nextStage] || job.assignedTo;
          return {...job, currentStage: nextStage, assignedTo: nextAssignee, updatedAt: now, completedAt: nextStage===JobStage.COMPLETED? now:undefined, history:[...job.history,{stage:nextStage,timestamp:now}]};
        }
      }
      return job;
    });
    setJobsState(updatedJobs);
    saveJobs(updatedJobs);
  };

  const handleDeleteJob = (id) => {
    if(window.confirm('Are you sure you want to delete this job?')){
      const updatedJobs = jobs.filter(j=>j.id!==id);
      setJobsState(updatedJobs);
      saveJobs(updatedJobs);
    }
  };

  if(!user) return <Login onLogin={handleLogin} />;

  return (
    <Layout activeTab={activeTab} onTabChange={setActiveTab} user={user} onLogout={handleLogout}>
      {activeTab==='dashboard' && <Dashboard jobs={jobs} />}
      {activeTab==='jobs' && <JobBoard jobs={jobs} onAdvance={handleAdvanceJob} onDelete={handleDeleteJob} />}
      {activeTab==='new' && <NewJob onSubmit={handleCreateJob} onCancel={()=>setActiveTab('jobs')} />}
      {activeTab==='admin' && user.role==='Admin' && <AdminPanel jobs={jobs} />}
    </Layout>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

  </script>
</body>
</html>
